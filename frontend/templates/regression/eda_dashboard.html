{% extends "regression.html" %}

{% block regression_content %}
<div class="container py-4">

  <!-- 📊 Page Header -->
  <h2 class="text-primary mb-4">
    <i class="bi bi-graph-up-arrow me-1"></i> Exploratory Data Analysis
  </h2>

  {% if error %}
  <div class="alert alert-warning shadow-sm">
    <i class="bi bi-exclamation-triangle-fill me-2"></i><strong>Warning:</strong> {{ error }}
  </div>
  {% endif %}

  <!-- 🧾 Dataset Overview -->
  {% if overview %}
  <div class="card mb-4 shadow-sm border-info">
    <div class="card-header bg-info text-white fw-semibold">
      <i class="bi bi-table me-1"></i> Dataset Overview
    </div>
    <div class="card-body">
      <p><strong>Shape:</strong> {{ overview.shape }}</p>
      <p><strong>Rows:</strong> {{ overview.n_rows }} &nbsp;|&nbsp; <strong>Columns:</strong> {{ overview.n_cols }}</p>

      <!-- Scrollable Columns List -->
      <div style="max-height: 250px; overflow-y: auto;">
        <ul class="list-group list-group-flush">
          {% for col in overview.columns %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            {{ col.Column }}
            <code class="text-muted">{{ col.Dtype }}</code>
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- 🔍 Run EDA -->
  <div class="mb-4">
    <form method="post" action="/regression/eda">
      <button type="submit" class="btn btn-outline-primary">
        <i class="bi bi-bar-chart-line me-1"></i> Run Descriptive Statistics & Plots
      </button>
    </form>
  </div>

  <!-- 📈 Summary & Missing Values -->
  {% if describe %}
  <div class="accordion mb-5" id="describeAccordion">

    <!-- Summary -->
    <div class="accordion-item border-success">
      <h2 class="accordion-header" id="summaryHeading">
        <button class="accordion-button" data-bs-toggle="collapse" data-bs-target="#collapseSummary" aria-expanded="true">
          <i class="bi bi-clipboard-data me-2"></i> Summary Statistics
        </button>
      </h2>
      <div id="collapseSummary" class="accordion-collapse collapse show">
        <div class="accordion-body overflow-auto" style="max-height: 400px;">
          {{ describe.summary | safe }}
        </div>
      </div>
    </div>

    <!-- Missing Values -->
    <div class="accordion-item border-warning">
      <h2 class="accordion-header" id="missingHeading">
        <button class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#collapseMissing">
          <i class="bi bi-question-circle me-2"></i> Missing Value Report
        </button>
      </h2>
      <div id="collapseMissing" class="accordion-collapse collapse">
        <div class="accordion-body overflow-auto" style="max-height: 400px;">
          {{ describe.missing | safe }}
        </div>
      </div>
    </div>

  </div>
  {% endif %}

  <!-- 🔹 Univariate Plots -->
  {% if univariate %}
  <h4 class="mt-4 mb-3"><i class="bi bi-bar-chart-fill me-2"></i> Univariate Plots</h4>
  <div class="row g-4">
    {% for plot in univariate %}
    <div class="col-12 col-md-6">
      <div class="card shadow-sm h-100">
        <iframe src="{{ plot }}" height="400" width="100%" frameborder="0" class="rounded-bottom"></iframe>
      </div>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- 🔸 Multivariate Plots -->
  {% if multivariate %}
  <h4 class="mt-5 mb-3"><i class="bi bi-diagram-2-fill me-2"></i> Multivariate Plots</h4>
  <div class="row g-4">
    {% for plot in multivariate %}
    <div class="col-12 col-md-6">
      <div class="card shadow-sm h-100">
        <iframe src="{{ plot }}" height="400" width="100%" frameborder="0" class="rounded-bottom"></iframe>
      </div>
    </div>
    {% endfor %}
  </div>
  {% endif %}

</div>
{% endblock %}
