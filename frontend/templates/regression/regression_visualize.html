{% extends "regression.html" %}

{% block regression_content %}
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

<div class="card bg-dark border-secondary shadow-sm">
  <div class="card-body">
    <h4 class="card-title text-info mb-2">üìä Visualize Your Data</h4>
    <p class="text-muted">
      Select X and optional Y column for visualization and choose your plot types.
    </p>

    {% if message %}
      <div class="alert alert-{{ message_type or 'info' }} mt-3">{{ message }}</div>
    {% endif %}

    <form method="post" action="/regression/visualize">
      <div class="row g-4">
        <!-- X Column -->
        <div class="col-md-4">
          <div class="border border-info rounded p-3 h-100 bg-black">
            <label class="form-label text-light">üßÆ Select X Column</label>
            <select class="form-select column-select bg-dark text-light" name="x_column">
              <option value="">-- Select Column --</option>
              {% for col in numeric_columns %}
                <option value="{{ col }}" {% if x_column == col %}selected{% endif %}>{{ col }}</option>
              {% endfor %}
            </select>
            <small class="text-muted d-block mt-2">Required for all plots.</small>
          </div>
        </div>

        <!-- Y Column -->
        <div class="col-md-4">
          <div class="border border-info rounded p-3 h-100 bg-black">
            <label class="form-label text-light">üßÆ Select Y Column (Optional)</label>
            <select class="form-select column-select bg-dark text-light" name="y_column">
              <option value="">-- Select Column --</option>
              {% for col in numeric_columns %}
                <option value="{{ col }}" {% if y_column == col %}selected{% endif %}>{{ col }}</option>
              {% endfor %}
            </select>
            <small class="text-muted d-block mt-2">Required for Scatter or Line plots.</small>
          </div>
        </div>

        <!-- Plot Types -->
        <div class="col-md-4">
          <div class="border border-info rounded p-3 h-100 bg-black">
            <label class="form-label text-light">üìê Select Plot Type(s)</label>
            <div class="btn-group d-flex flex-wrap" role="group">
              <input type="checkbox" class="btn-check" name="plot_types" value="scatter" id="scatter"
                     {% if plot_types and 'scatter' in plot_types %}checked{% endif %}>
              <label class="btn btn-outline-info m-1" for="scatter">Scatter</label>

              <input type="checkbox" class="btn-check" name="plot_types" value="histogram" id="histogram"
                     {% if plot_types and 'histogram' in plot_types %}checked{% endif %}>
              <label class="btn btn-outline-info m-1" for="histogram">Histogram</label>

              <input type="checkbox" class="btn-check" name="plot_types" value="lineplot" id="lineplot"
                     {% if plot_types and 'lineplot' in plot_types %}checked{% endif %}>
              <label class="btn btn-outline-info m-1" for="lineplot">Line Plot</label>
            </div>
            <small class="text-muted mt-2 d-block">Line plot is useful for trends or time-series data.</small>
          </div>
        </div>

        <!-- Scatter Limit -->
        <div class="col-md-4">
          <div class="border border-info rounded p-3 h-100 bg-black">
            <label class="form-label text-light">üî¢ Limit (for Scatter Plot)</label>
            <input type="number" class="form-control bg-dark text-light border-info" name="scatter_limit"
                   value="{{ scatter_limit or 100 }}" min="10" step="10">
            <small class="text-muted d-block mt-2">
              Limits number of points in scatter plot (default: 100).
            </small>
          </div>
        </div>
      </div>

      <div class="mt-4 d-flex justify-content-between">
        <a href="/regression/visualize" class="btn btn-outline-warning">üîÑ Reset</a>
        <button class="btn btn-outline-info px-4" type="submit">üìà Generate Visualizations</button>
      </div>
    </form>

    <!-- Rendered Plots -->
    {% if plots %}
      <hr class="my-4 border-light">
      <h5 class="text-light mb-3">üñºÔ∏è Generated Visualizations</h5>
      {% for plot_html in plots %}
        <div class="mb-4 border rounded bg-black p-2 shadow-sm">
          {{ plot_html | safe }}
        </div>
      {% endfor %}
    {% endif %}
  </div>
</div>

<!-- Select2 JS -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
  $(document).ready(function() {
    $('.column-select').select2({
      theme: 'classic',
      width: '100%',
      placeholder: 'Select column'
    });
  });
</script>

<!-- Dark Theme for Select2 -->
<style>
  .select2-container--classic .select2-selection--single {
    background-color: #000;
    color: #fff;
    border: 1px solid #17a2b8;
  }
  .select2-container--classic .select2-dropdown {
    background-color: #1e1e1e;
    color: #fff;
  }
  .select2-results__option {
    color: #fff;
  }
  .select2-results__option--highlighted {
    background-color: #17a2b8;
    color: #000;
  }
</style>
{% endblock %}
