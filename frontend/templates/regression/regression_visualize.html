{% extends "regression.html" %}

{% block regression_content %}
<div class="card bg-dark border-secondary shadow-sm">
  <div class="card-body">
    <h4 class="card-title text-info mb-2">📊 Visualize Your Data</h4>
    <p class="text-muted">Choose <strong>up to 2 numeric columns</strong> and one or more plot types to explore your dataset interactively.</p>

    {% if message %}
      <div class="alert alert-{{ message_type or 'info' }} mt-3">{{ message }}</div>
    {% endif %}

    <form method="post" action="/regression/visualize">
      <div class="row g-4">
        <!-- Column Selection -->
        <div class="col-md-4">
          <div class="border border-info rounded p-3 h-100 bg-black">
            <label class="form-label text-light">🧮 Select up to 2 Columns</label>
            <div class="form-group overflow-auto" style="max-height: 250px;">
              {% for col in numeric_columns %}
                <div class="form-check">
                  <input class="form-check-input column-checkbox" type="checkbox" name="selected_columns" value="{{ col }}"
                         {% if selected_columns and col in selected_columns %}checked{% endif %}>
                  <label class="form-check-label text-light">{{ col }}</label>
                </div>
              {% endfor %}
            </div>
            <small class="text-muted d-block mt-2">✅ 1 column: Histogram/Boxplot<br>✅ 2 columns: Scatter or Category-wise Boxplot</small>
          </div>
        </div>

        <!-- Plot Types -->
        <div class="col-md-4">
          <div class="border border-info rounded p-3 h-100 bg-black">
            <label class="form-label text-light">📐 Select Plot Type(s)</label>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="plot_types" value="scatter"
                     {% if plot_types and 'scatter' in plot_types %}checked{% endif %}>
              <label class="form-check-label text-light">Scatter Plot</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="plot_types" value="histogram"
                     {% if plot_types and 'histogram' in plot_types %}checked{% endif %}>
              <label class="form-check-label text-light">Histogram</label>
            </div>
            <div class="form-check">

              <input class="form-check-input" type="checkbox" name="plot_types" value="lineplot"
                {% if plot_types and 'lineplot' in plot_types %}checked{% endif %}>
              <label class="form-check-label text-light">Line Plot</label>
            </div>
            <small class="text-muted mt-2 d-block">Line plot is useful for trend or time-based comparison.</small>

          </div>
        </div>

        <!-- Optional Limit -->
        <div class="col-md-4">
          <div class="border border-info rounded p-3 h-100 bg-black">
            <label class="form-label text-light">🔢 Limit (for Scatter Plot)</label>
            <input type="number" class="form-control bg-dark text-light border-info" name="scatter_limit"
                   value="{{ scatter_limit or 100 }}" min="10" step="10">
            <small class="text-muted d-block mt-2">Limits the number of points in scatter plot (default: 100).</small>
          </div>
        </div>
      </div>

      <div class="mt-4 text-end">
        <button class="btn btn-outline-info px-4" type="submit">📈 Generate Visualizations</button>
      </div>
    </form>

    <!-- Rendered Plots -->
    {% if plots %}
      <hr class="my-4 border-light">
      <h5 class="text-light mb-3">🖼️ Generated Visualizations</h5>
      {% for plot_html in plots %}
        <div class="mb-4 border rounded bg-black p-2 shadow-sm">
          {{ plot_html | safe }}
        </div>
      {% endfor %}
    {% endif %}
  </div>
</div>

<!-- JS: Enforce Max 2 Column Selection -->
<script>
  document.querySelectorAll('.column-checkbox').forEach(cb => {
    cb.addEventListener('change', () => {
      const checked = document.querySelectorAll('.column-checkbox:checked');
      if (checked.length > 2) {
        cb.checked = false;
        alert("You can only select up to 2 columns.");
      }
    });
  });
</script>
{% endblock %}
