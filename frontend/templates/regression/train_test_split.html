{% extends "regression.html" %}
{% block regression_content %}

<h4 class="text-info mb-4">Trainâ€‘Test Splitting Options</h4>

{% if not xy_state.y %}
  <div class="alert alert-warning">
    Please define <strong>X</strong> and <strong>y</strong> first in the <b>Feature Selection</b> step.
  </div>
{% else %}
  <form method="post" class="row g-4 align-items-end">

    <!-- ðŸ”€ Split Method -->
    <div class="col-md-5">
      <label class="form-label">Split Method</label>
      <select class="form-select" name="split_method" onchange="toggleSplitMethod(this.value)" required>
        <option value="random" selected>Random Train-Test Split</option>
        <option value="seq">Sequential Train-Test Split</option>
      </select>
    </div>

    <!-- ðŸ“ Random Split Options -->
    <div id="random-options" class="row gx-3">
      <div class="col-md-5 mt-3">
        <label class="form-label">Test Size</label>
        <select class="form-select" name="test_size_predefined" onchange="document.getElementById('manual_test_size').value = '';">
          <option value="">â€” Choose from options â€”</option>
          <option value="0.1">0.1 (10%)</option>
          <option value="0.2" selected>0.2 (20%)</option>
          <option value="0.3">0.3 (30%)</option>
        </select>
        <small class="text-muted">Or enter manually below</small>
        <input type="number" id="manual_test_size" name="test_size_manual" class="form-control mt-1" step="0.01" min="0.05" max="0.95" placeholder="e.g., 0.33">
      </div>
      <div class="col-md-4 mt-3">
        <label class="form-label">Random State</label>
        <input type="number" name="random_state" class="form-control" value="42" required>
      </div>
    </div>

    <!-- ðŸ” Sequential Split Options -->
    <div id="seq-options" class="row gx-3" style="display: none;">
      <div class="col-md-5 mt-3">
        <label class="form-label">Test Size</label>
        <select class="form-select" name="seq_test_size_predefined" onchange="document.getElementById('seq_manual_test_size').value = '';">
          <option value="">â€” Choose from options â€”</option>
          <option value="0.1">0.1 (10%)</option>
          <option value="0.2" selected>0.2 (20%)</option>
          <option value="0.3">0.3 (30%)</option>
        </select>
        <small class="text-muted">Or enter manually below</small>
        <input type="number" id="seq_manual_test_size" name="seq_test_size_manual" class="form-control mt-1" step="0.01" min="0.05" max="0.95" placeholder="e.g., 0.33">
      </div>
    </div>

    <!-- ðŸš€ Submit -->
    <div class="col-md-3 mt-3 d-grid">
      <button type="submit" class="btn btn-outline-success">Split Dataset</button>
    </div>
  </form>
{% endif %}

<!-- â„¹ Message -->
{% if message %}
  <div class="alert alert-info mt-4">{{ message }}</div>
{% endif %}

<!-- ðŸ”Ž Preview -->
{% if preview and preview.shapes %}
  <hr class="border-secondary mt-5 mb-4">
  <h5 class="text-light">Preview of Train-Test Split</h5>
  <p class="text-muted mb-2">
    Shapes â€” <code>X_train</code>: {{ preview.shapes.X_train }},
    <code>X_test</code>: {{ preview.shapes.X_test }},
    <code>y_train</code>: {{ preview.shapes.y_train }},
    <code>y_test</code>: {{ preview.shapes.y_test }}
  </p>
  <div class="row">
    {% for key, df in preview.items() if key != 'shapes' %}
      <div class="col-md-6 mb-4">
        <h6 class="text-warning">{{ key }}</h6>
        <div class="table-responsive">
          {{ df.to_html(classes="table table-sm table-dark", index=False) | safe }}
        </div>
      </div>
    {% endfor %}
  </div>
{% endif %}

<script>
function toggleSplitMethod(method) {
  document.getElementById("random-options").style.display = method === "random" ? "flex" : "none";
  document.getElementById("seq-options").style.display = method === "seq" ? "flex" : "none";
}
</script>

{% endblock %}
